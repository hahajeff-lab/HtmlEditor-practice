<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/dialog/dialog.min.css">
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2c3e50">    
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„é›¢ç·š HTML ç·¨è¼¯å™¨</title>
    
    <link rel="stylesheet" href="codemirror.css">
ã€€ã€€<link rel="stylesheet" href="monokai.css">
    
<style>
    /* 1. åœ°åŸºï¼šè®“ body è®Šæˆä¸€å€‹å‚ç›´çš„ç›’å­ */
    html, body { 
        margin: 0; 
        padding: 0; 
        height: 100%; 
        display: flex; 
        flex-direction: column; 
        background: #1e1e1e; /* ç¶²é åº•è‰² */
    }

    /* 2. æ¨™é¡Œæ¬„ï¼šä½¿ç”¨ flex è®“æ¨™é¡Œèˆ‡æŒ‰éˆ•ç¾¤å·¦å³å°é½Š */
    .header {
        height: 55px;
        background: #2c3e50; /* é¸ç”¨æ·±è—ç°è‰²ï¼Œè®“ç™½è‰²æŒ‰éˆ•æ›´æ˜é¡¯ */
        color: #ddd;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 15px;
        flex-shrink: 0;
        font-family: sans-serif;
        border-bottom: 1px solid #1a252f;
    }

    /* æŒ‰éˆ•å®¹å™¨ */
    .file-ops {
        display: flex;
        gap: 8px; /* æŒ‰éˆ•é–“çš„è·é›¢ */
    }

    /* ä½ è¦æ±‚çš„ç°¡ç´„ç™½è‰²åœ“è§’æ¡†æŒ‰éˆ• */
    .file-ops button {
        background: transparent;
        color: white;
        border: 1px solid white;
        border-radius: 6px;
        padding: 4px 10px;
        font-size: 14px;
        cursor: pointer;
        transition: 0.2s;
    }

    /* é»æ“Šæ™‚é¡è‰²åè½‰çš„åé¥‹æ•ˆæœ */
    .file-ops button:active {
        background: white;
        color: #2c3e50;
    }

    /* 3. ç·¨è¼¯å™¨ä¸»é«” */
    .CodeMirror { 
        flex: 1; 
        height: 100% !important; 
        font-size: 16px; 
    }

/* åˆ†é æŒ‰éˆ•æ¨£å¼ */
    .tabs {
        display: flex;
        background: #2c3e50;
        flex-shrink: 0;
    }
    .tabs button {
        flex: 1;
        padding: 10px;
        background: #34495e;
        color: #bdc3c7;
        border: none;
        outline: none;
        cursor: pointer;
        font-size: 14px;
    }
    .tabs button.active {
        background: #1e1e1e; /* èˆ‡ç·¨è¼¯å™¨åŒè‰² */
        color: white;
        border-bottom: 2px solid #3498db;
    }

    /* é è¦½è¦–çª—æ¨£å¼ */
    #preview-window {
        display: none; /* é è¨­éš±è— */
        flex-grow: 1;
        width: 100%;
        border: none;
        background: white; /* ç¶²é é è¦½é€šå¸¸ç”¨ç™½åº• */
    }

/* æ–¹ä¾¿ç¬¦è™Ÿæ¨£å¼ */
.symbol-bar {
        display: flex;
        background: #333;
        padding: 5px;
        overflow-x: auto; /* å¯¬åº¦ä¸å¤ æ™‚å¯æ»‘å‹• */
        white-space: nowrap;
        flex-shrink: 0;
        border-bottom: 1px solid #444;
    }

    .symbol-bar button {
        background: #444;
        color: white;
        border: 1px solid #555;
        border-radius: 4px;
        padding: 8px 12px;
        margin-right: 6px;
        font-size: 16px;
        flex-shrink: 0; /* é˜²æ­¢æŒ‰éˆ•è¢«å£“æ‰ */
    }

    .symbol-bar button:active {
        background: #666;
    }
  
  .CodeMirror-dialog {/* æœå°‹æ¡†æ¨£å¼ */
    background: #2c3e50;
    color: white;
    padding: 10px;
    font-family: sans-serif;
    border-bottom: 2px solid #3498db;
}
.CodeMirror-dialog input {/* æœå°‹æ¡†è¼¸å…¥æ¨£å¼ */
    background: #1e1e1e;
    color: white;
    border: 1px solid #555;
    padding: 5px;
    margin-left: 5px;
}
</style>
</head>
<body>
    <div class="header">
	<div class="title">HTML Editor</div>
    <div class="file-ops">
        <button onclick="newFile()">æ–°å»º</button>
        <button onclick="saveFile()">å­˜æª”</button>
        <button onclick="loadFile()">è®€å–</button>
    </div>
 </div>

<div class="tabs"><!--åˆ†é æ¨™ç±¤-->
    <button id="edit-tab" class="active" onclick="switchTab('edit')">ç·¨è¼¯ç¨‹å¼ç¢¼</button>
    <button id="preview-tab" onclick="switchTab('preview')">å³æ™‚é è¦½</button>
</div>

<div class="symbol-bar"><!--æ‰‹æ©Ÿæ–¹ä¾¿ç¬¦è™Ÿ-->
    <button onclick="addBrackets()">&lt;&gt;</button> <button onclick="addQuotes()">""</button>      
<button onclick="addParentheses()">()</button> 
  <button onclick="addChar('/')">/</button>   
    <button onclick="addChar('=')">=</button>
    <button onclick="addChar('!')">!</button>
    <button onclick="addChar(' ')">ç©ºæ ¼</button>
<button onclick="addChar('\t')">Tab</button>
<button onclick="editor.execCommand('find')">ğŸ” æœå°‹</button>

  </div>

<textarea id="my-code-area"></textarea><!--ç·¨è¼¯å€-->
  
<iframe id="preview-window"></iframe><!--é è¦½åˆ†é -->
    <script src="codemirror.js"></script>
    <script src="xml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/dialog/dialog.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/search/searchcursor.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/search/search.min.js"></script>
    <script>
var editor; // åœ¨æœ€å¤–å±¤å®£å‘Šï¼Œå®ƒæ˜¯å…¨åŸŸçš„å¤§è…¦
        if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
    .then(() => console.log("é›¢ç·šåŠŸèƒ½å·²å•Ÿå‹•"));
}
window.onload = function() {
            // å˜—è©¦å¾æœ¬åœ°å„²å­˜è®€å–èˆŠå…§å®¹
            var saved = localStorage.getItem("my_code") || "<h1>ä½ å¥½ï¼</h1>";

           editor = CodeMirror.fromTextArea(document.getElementById("my-code-area"), {
                lineNumbers: true,
                mode: "text/html",
                lineWrapping: true,
                htmlMode: true,
                autofocus: true,
		theme: "monokai"  // <--- åŠ å…¥é€™ä¸€è¡Œï¼Œæ›ä¸Šæ·±è‰²è¡£æœï¼
            });

            editor.setValue(saved);

            // è‡ªå‹•å„²å­˜åŠŸèƒ½
            editor.on("change", function() {
                localStorage.setItem("my_code", editor.getValue());
            });

            // å¼·åˆ¶åˆ·æ–°ä»¥ç¢ºä¿é¡¯ç¤ºæ­£å¸¸
            setTimeout(function() { editor.refresh(); }, 200);
        };
//æ’å…¥ç¬¦è™ŸåŠŸèƒ½
function addChar(char) {
    if (editor) {
        // å–å¾—ç›®å‰çš„æ¸¸æ¨™ä½ç½®
        var cursor = editor.getCursor();
        // åœ¨è©²ä½ç½®æ’å…¥å­—å…ƒ
        editor.replaceRange(char, cursor);
        // é‡è¦ï¼šè®“ç·¨è¼¯å™¨é‡æ–°ç²å¾—ç„¦é»ï¼Œæ‰‹æ©Ÿéµç›¤æ‰ä¸æœƒç¸®å›å»
        editor.focus();
    }
}
//è‡ªå‹•å…©å€‹é›™å¼•è™Ÿ
function addQuotes() {
    var cursor = editor.getCursor();
    editor.replaceRange('""', cursor);
    // æŠŠæ¸¸æ¨™å¾€å›ç§»å‹•ä¸€æ ¼ï¼Œåœåœ¨å…©å€‹å¼•è™Ÿä¸­é–“
    editor.setCursor({ line: cursor.line, ch: cursor.ch + 1 });
    editor.focus();
}
// æˆå°å°–æ‹¬è™Ÿ <>
function addBrackets() {
    if (editor) {
        var cursor = editor.getCursor();
        editor.replaceRange('<>', cursor);
        editor.setCursor({ line: cursor.line, ch: cursor.ch + 1 });
        editor.focus();
    }
}

// æˆå°æ‹¬è™Ÿ () - ä¹‹å¾Œå¯« CSS æˆ– JS å¯èƒ½ç”¨åˆ°
function addParentheses() {
    if (editor) {
        var cursor = editor.getCursor();
        editor.replaceRange('()', cursor);
        editor.setCursor({ line: cursor.line, ch: cursor.ch + 1 });
        editor.focus();
    }
}
// 1. æ–°å»ºæª”æ¡ˆ
function newFile() {
    if (confirm("ç¢ºå®šè¦æ–°å»ºæª”æ¡ˆå—ï¼Ÿæœªå­˜æª”çš„å…§å®¹å°‡æœƒæ¶ˆå¤±ã€‚")) {
        window.editor.setValue("<!DOCTYPE html>\n<html>\n<body>\n\n</body>\n</html>");
    }
}

// 2. å­˜æª” (ä¸‹è¼‰ç‚º HTML æª”æ¡ˆ)
function saveFile() {
    var content = window.editor.getValue();
    var blob = new Blob([content], { type: "text/html" });
    var a = document.createElement("a");
    
    // æª”åè¨­å®š (å¯ä»¥åŠ å…¥æ™‚é–“é¿å…é‡è¤‡)
    var fileName = "my_code_" + new Date().getTime() + ".html";
    
    a.href = URL.createObjectURL(blob);
    a.download = fileName;
// é—œéµä¿®æ­£ï¼šå¿…é ˆåŠ å…¥ body æ‰èƒ½åœ¨éƒ¨åˆ†ç’°å¢ƒè§¸ç™¼ click
    document.body.appendChild(a);
    a.click();
document.body.removeChild(a); // ç”¨å®Œå³ä¸Ÿ
    URL.revokeObjectURL(a.href);
}

// 3. è®€å–æœ¬åœ°æª”æ¡ˆ
function loadFile() {
    // å»ºç«‹ä¸€å€‹éš±è—çš„ input ä¾†é¸æª”æ¡ˆ
    var input = document.createElement('input');
    input.type = 'file';
    input.accept = '.html,.txt';
    
    input.onchange = e => {
        var file = e.target.files[0];
if (!file) return;
        var reader = new FileReader();
        reader.onload = readerEvent => {
            var content = readerEvent.target.result;
            editor.setValue(content);
        }
        reader.readAsText(file, 'UTF-8');
    }
    input.click();
}

function switchTab(mode) {
    var editTab = document.getElementById('edit-tab');
    var previewTab = document.getElementById('preview-tab');
    var editorEl = document.querySelector('.CodeMirror'); // CodeMirror ç”¢ç”Ÿçš„å®¹å™¨
    var previewEl = document.getElementById('preview-window');

    if (mode === 'preview') {
        // 1. åˆ‡æ›æŒ‰éˆ•ç‹€æ…‹
        editTab.classList.remove('active');
        previewTab.classList.add('active');
        
        // 2. é¡¯ç¤ºé è¦½ï¼Œéš±è—ç·¨è¼¯
        editorEl.style.display = 'none';
        previewEl.style.display = 'block';
        
        // 3. æŠŠç¨‹å¼ç¢¼æ¸²æŸ“åˆ° iframe è£¡
        var code = editor.getValue();
        var previewDoc = previewEl.contentDocument || previewEl.contentWindow.document;
        previewDoc.open();
        previewDoc.write(code);
        previewDoc.close();
    } else {
        // åˆ‡æ›å›ç·¨è¼¯æ¨¡å¼
        editTab.classList.add('active');
        previewTab.classList.remove('active');
        editorEl.style.display = 'block';
        previewEl.style.display = 'none';
        
        // å›åˆ°ç·¨è¼¯å™¨å¾Œé‡æ–°æ•´ç†ä¸€ä¸‹ï¼Œé˜²æ­¢è·‘ç‰ˆ
        editor.refresh();
    }
}
    var editor;

    // 1. åˆå§‹åŒ–ç·¨è¼¯å™¨
    window.onload = function() {
        editor = CodeMirror.fromTextArea(document.getElementById("my-code-area"), {
            lineNumbers: true,
            mode: "text/html",
            theme: "monokai",
            lineWrapping: true
        });
        
        // è®€å–ä¸Šæ¬¡å­˜æª” (å¦‚æœæœ‰)
        var saved = localStorage.getItem("html_code");
        if (saved) editor.setValue(saved);
        
        // å¼·åˆ¶åˆ·æ–°ç¢ºä¿ä¸è®Šæ‰
        setTimeout(function() { editor.refresh(); }, 300);
    };

    // 2. åˆ†é åˆ‡æ›é‚è¼¯ (ç·¨è¼¯ vs é è¦½)
    function switchTab(mode) {
        var editTab = document.getElementById('edit-tab');
        var previewTab = document.getElementById('preview-tab');
        var editorEl = document.querySelector('.CodeMirror');
        var previewWindow = document.getElementById('preview-window');

        if (mode === 'preview') {
            // åˆ‡æ›åˆ°é è¦½
            editTab.classList.remove('active');
            previewTab.classList.add('active');
            editorEl.style.display = 'none';
            previewWindow.style.display = 'block';
            
            // å°‡ç·¨è¼¯å™¨çš„å…§å®¹å¯«å…¥ iframe
            var content = editor.getValue();
            var doc = previewWindow.contentDocument || previewWindow.contentWindow.document;
            doc.open();
            doc.write(content);
            doc.close();
        } else {
            // åˆ‡æ›åˆ°ç·¨è¼¯
            previewTab.classList.remove('active');
            editTab.classList.add('active');
            editorEl.style.display = 'block';
            previewWindow.style.display = 'none';
            editor.refresh(); // å›ä¾†æ™‚åˆ·æ–°ä¸€ä¸‹ç¢ºä¿ä½ˆå±€æ­£ç¢º
        }
    }

    // 3. ç¬¦è™Ÿè¼¸å…¥åŠŸèƒ½ (ç¯„ä¾‹)
    function addChar(char) {
        var doc = editor.getDoc();
        var cursor = doc.getCursor();
        doc.replaceRange(char, cursor);
        editor.focus();
    }
    
    function addQuotes() { addChar('""'); }
    function addBrackets() { addChar('<>'); }
    function addParentheses() { addChar('()'); }
    
    // 4. å­˜æª”åŠŸèƒ½
    function saveFile() {
        localStorage.setItem("html_code", editor.getValue());
        alert("å·²å­˜æª”è‡³æœ¬åœ°å„²å­˜ç©ºé–“");
    }

    </script>
</body>
</html>
